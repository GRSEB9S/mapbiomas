<script type="text/javascript">
  function buildUrl(biome, collection, year){
    if (collection == '1') {
      return 'http://seeg-mapbiomas.terras.agr.br/dashboard/downloads/collection/CONSOLIDACAO/'+ biome + '/' + year ;
    } else if (collection == '2') {
      return 'http://storage.googleapis.com/mapbiomas-public/COLECAO/2/CONSOLIDACAO/' + year + '/' + biome + '_' + year + '.tif';
    } else {
      return 'http://storage.googleapis.com/mapbiomas-public/COLECAO/2_3/CONSOLIDACAO/' + biome + '.tif';
    }
  }

  function refreshUrls() {
    var collection = $('#collection').val();
    var year = $('#year').val();
    var url = ''
    
    $('a[biome]').each(function() {
      var biome = $(this).attr('biome');
      var url = buildUrl(biome, collection, year);

      $(this).attr('href', url);
    });
  }

  $(document).on('change', '#collection', function() {
    if($(this).val() == '1') {
      $('#year').find('option').prop('disabled', false);
      $('#year').find('option[value="2016"]', 'option').prop('disabled', true);
      $('#year').find('option[value="all_years"]', 'option').prop('disabled', true);
      $('#year').find('option:first-child').prop('selected', true)
    } else if($(this).val() == '2') {
      $('#year').find('option').prop('disabled', false);
      $('#year').find('option[value="2016"]').prop('disabled', false);
      $('#year').find('option[value="all_years"]', 'option').prop('disabled', true);
      $('#year').find('option:first-child').prop('selected', true)
    } else {
      $('#year').find('option').prop('disabled', true);
      $('#year').find('option[value="all_years"]').prop('disabled', false);
      $('#year').find('option[value="all_years"]').prop('selected', true);
    }

    $('#year').trigger('change');
    
    refreshUrls();
  });

  $(document).on('change', '#year', function() {
    refreshUrls();
  });

  $(function() {
    $('#collection').trigger('change');
    refreshUrls();
  });
</script>

<article class="page page__mapbiomas-collections">
  <div class="page__container">
    <h1 class="page__title">Coleções MAPBIOMAS</h1>

    <p>From the LANDSAT mosaics the classifications process starts, resulting in the annual land use land cover maps. Within the logic proposed by MAPBIOMAS the maps are updated every time there is an improvement in the classification algorithms. The classification methodology is dynamic and procedural, with the purpose of improving the classification of each typology.</p>

    <p>Here you can access the land use and land cover maps organized per biome and year.</p>

    <blockquote>
      <strong>Warning:</strong> When composing a single mosaic or calculating statistics it should be noted that:
      <ul>
        <li>For area calculation, it is necessary to use a suitable metric projection.</li>
        <li>The limits of Biomes were adapted by MapBiomas team from the original scale 1:5.000.000 published by the IBGE to 1: 1,000,000. This adaptation was based on the Territorial Boundaries Maps of Brazil 1: 250,000 (IBGE) and physiognomies map 1: 1,000,000 also from the IBGE. The Shape of those limits is available for download along with the reference maps.</li>
        <li>All data are in GeoTiff format and have LZW compression.</li>
        <li>For collection 2.3 the anual maps area consolidated in a single file with 17 bands. Each band represents one year of classification (band 1=2000; band 17=2016). For the previous collections it's necessary to download each year separately. </li>
      </ul>
    </blockquote>

    <p> Alternatively you can access and process MapBiomas Collection 2.3 directly as Google Earth Engine (GEE). Access the public asset <%= link_to 'here', page_path('scripts') %> to access the asset IDs.</p>

    <div class="page__box-download">
      <%= select_tag "collection", options_for_select([["Collection 2.3", 3], ["Collection 2", 2], ["Collection 1", 1]]), id: "collection" %>
      <%= select_tag "year", options_for_select(Setting.available_years << ['All years', 'all_years']), id: "year" %>
    </div>

    <div class="methodology-presentation">
      <%= image_tag "amazonia.png" %>
      <div class="methodology-presentation__title">
        <a href='' biome='AMAZONIA' target="_blank">Amazon</a>
      </div>
    </div>
    <div class="methodology-presentation">
      <%= image_tag "pantanal.png" %>
      <div class="methodology-presentation__title">
        <a href='' biome='PANTANAL' target="_blank">Pantanal</a>
      </div>
    </div>
    <div class="methodology-presentation">
      <%= image_tag "caatinga.png" %>
      <div class="methodology-presentation__title">
        <a href='' biome='CAATINGA' target="_blank">Caatinga</a>
      </div>
    </div>
    <div class="methodology-presentation">
      <%= image_tag "mata_atlantica.png" %>
      <div class="methodology-presentation__title">
        <a href='' biome='MATAATLANTICA' target="_blank">Atlantic Forest</a>
      </div>
    </div>
    <div class="methodology-presentation">
      <%= image_tag "cerrado.png" %>
      <div class="methodology-presentation__title">
        <a href='' biome='CERRADO' target="_blank">Cerrado</a>
      </div>
    </div>
    <div class="methodology-presentation">
      <%= image_tag "pampa.png" %>
      <div class="methodology-presentation__title">
        <a href='' biome='PAMPA' target="_blank">Pampa</a>
      </div>
    </div>
  </div>
</article>
